<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Neon Shooter Arena</title>
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <style>
    body {
      background: radial-gradient(circle at top, #0f172a, #020617 60%);
    }
    .glow {
      box-shadow: 0 0 20px rgba(59, 130, 246, 0.6), 0 0 40px rgba(16, 185, 129, 0.4);
    }
    canvas {
      background: radial-gradient(circle at center, rgba(59,130,246,0.15), transparent 65%);
    }
    .scanlines {
      background: repeating-linear-gradient(
        to bottom,
        rgba(255,255,255,0.03),
        rgba(255,255,255,0.03) 1px,
        transparent 1px,
        transparent 3px
      );
    }
  </style>
</head>
<body class="text-slate-100 min-h-screen flex flex-col">
  <header class="px-6 py-6 flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
    <div>
      <h1 class="text-3xl md:text-4xl font-bold tracking-wider text-emerald-300">Neon Shooter Arena</h1>
      <p class="text-slate-300 mt-2 max-w-2xl">Ứng dụng chơi game bắn súng máy bay tương lai. Di chuyển bằng phím mũi tên hoặc WASD, bắn bằng Space. Tiêu diệt địch để nhận vật phẩm nâng cấp: Bắn đạn chùm (Multi-shot), Bắn nhanh (Rapid Fire) và Giáp (Shield).</p>
    </div>
    <div class="flex gap-4">
      <button id="startBtn" class="px-6 py-3 rounded-full bg-emerald-400 text-slate-900 font-semibold hover:bg-emerald-300 transition shadow-lg shadow-emerald-500/20">Bắt đầu</button>
      <button id="pauseBtn" class="px-6 py-3 rounded-full bg-slate-700 text-slate-100 hover:bg-slate-600 transition">Tạm dừng</button>
    </div>
  </header>

  <main class="flex-1 px-6 pb-6 grid grid-cols-1 lg:grid-cols-[1.2fr_0.8fr] gap-6">
    <section class="rounded-3xl p-4 bg-slate-900/70 border border-slate-700 glow relative overflow-hidden">
      <div class="scanlines absolute inset-0 opacity-40 pointer-events-none"></div>
      <canvas id="gameCanvas" width="900" height="520" class="rounded-2xl w-full h-[420px] md:h-[520px]"></canvas>
      <div id="overlay" class="absolute inset-0 flex items-center justify-center bg-slate-900/80 opacity-0 pointer-events-none transition">
        <div class="text-center">
          <h2 class="text-3xl font-bold text-emerald-300">Tạm dừng</h2>
          <p class="mt-2 text-slate-200">Nhấn "Bắt đầu" để tiếp tục.</p>
        </div>
      </div>
    </section>

    <aside class="flex flex-col gap-6">
      <div class="bg-slate-900/70 border border-slate-700 rounded-3xl p-6">
        <h3 class="text-xl font-semibold text-emerald-200">Bảng điều khiển</h3>
        <div class="grid grid-cols-2 gap-4 mt-4">
          <div class="bg-slate-800/70 rounded-2xl p-4">
            <p class="text-xs uppercase tracking-wider text-slate-400">Điểm số</p>
            <p id="score" class="text-2xl font-bold text-emerald-300">0</p>
          </div>
          <div class="bg-slate-800/70 rounded-2xl p-4">
            <p class="text-xs uppercase tracking-wider text-slate-400">Máu</p>
            <p id="health" class="text-2xl font-bold text-sky-300">100%</p>
          </div>
          <div class="bg-slate-800/70 rounded-2xl p-4">
            <p class="text-xs uppercase tracking-wider text-slate-400">Combo</p>
            <p id="combo" class="text-2xl font-bold text-purple-300">x1</p>
          </div>
          <div class="bg-slate-800/70 rounded-2xl p-4">
            <p class="text-xs uppercase tracking-wider text-slate-400">Năng lượng</p>
            <p id="energy" class="text-2xl font-bold text-yellow-300">0%</p>
          </div>
        </div>
        <div class="mt-6 bg-slate-800/70 rounded-2xl p-4">
          <h4 class="text-sm font-semibold text-slate-200">Kỹ năng đặc biệt</h4>
          <p class="text-xs text-slate-400 mt-2">Khi năng lượng đầy, nhấn phím Shift để kích hoạt chế độ bắn nhanh.</p>
          <div class="mt-4 flex items-center gap-3">
            <div class="flex-1 h-3 bg-slate-700 rounded-full overflow-hidden">
              <div id="energyBar" class="h-full bg-yellow-300" style="width:0%"></div>
            </div>
            <span id="energyLabel" class="text-sm text-yellow-200">0%</span>
          </div>
        </div>
      </div>
      <div class="bg-slate-900/70 border border-slate-700 rounded-3xl p-6">
        <h3 class="text-xl font-semibold text-emerald-200">Hướng dẫn & Vật phẩm</h3>
        <ul class="mt-4 space-y-3 text-slate-300 text-sm">
          <li><span class="text-blue-400 font-bold">M</span> : Bắn đạn chùm (Multi-shot).</li>
          <li><span class="text-yellow-400 font-bold">R</span> : Bắn cực nhanh (Rapid Fire).</li>
          <li><span class="text-cyan-400 font-bold">S</span> : Giáp bảo vệ (Shield).</li>
          <li>Space: Bắn đạn. Shift: Kỹ năng đặc biệt.</li>
        </ul>
      </div>
    </aside>
  </main>

  <footer class="px-6 py-4 text-center text-xs text-slate-500">Thiết kế bởi trợ lý AI • Trải nghiệm bắn súng máy bay chiến đấu</footer>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    const scoreEl = document.getElementById('score');
    const healthEl = document.getElementById('health');
    const comboEl = document.getElementById('combo');
    const energyEl = document.getElementById('energy');
    const energyBar = document.getElementById('energyBar');
    const energyLabel = document.getElementById('energyLabel');
    const startBtn = document.getElementById('startBtn');
    const pauseBtn = document.getElementById('pauseBtn');
    const overlay = document.getElementById('overlay');

    const SKILLS = {
      MULTI: 'multi',
      RAPID: 'rapid',
      SHIELD: 'shield'
    };

    const state = {
      running: false,
      paused: true,
      score: 0,
      health: 100,
      combo: 1,
      energy: 0,
      rapidMode: false,
      rapidModeTimer: 0,
      rapidTimer: 0,
      multiShotTimer: 0,
      shieldTimer: 0,
      lastShot: 0,
      spawnTimer: 0,
    };

    const player = {
      x: canvas.width / 2,
      y: canvas.height - 80,
      radius: 22,
      speed: 5,
    };

    const keys = {};
    const bullets = [];
    const enemies = [];
    const particles = [];
    const powerUps = [];

    function resetGame() {
      state.score = 0;
      state.health = 100;
      state.combo = 1;
      state.energy = 0;
      state.rapidMode = false;
      state.rapidModeTimer = 0;
      state.rapidTimer = 0;
      state.multiShotTimer = 0;
      state.shieldTimer = 0;
      state.lastShot = 0;
      state.spawnTimer = 0;
      bullets.length = 0;
      enemies.length = 0;
      particles.length = 0;
      powerUps.length = 0;
      player.x = canvas.width / 2;
      player.y = canvas.height - 80;
      updateHUD();
    }

    function updateHUD() {
      scoreEl.textContent = state.score;
      healthEl.textContent = `${Math.max(0, state.health)}%`;
      comboEl.textContent = `x${state.combo}`;
      energyEl.textContent = `${Math.min(100, Math.floor(state.energy))}%`;
      energyBar.style.width = `${Math.min(100, state.energy)}%`;
      energyLabel.textContent = `${Math.min(100, Math.floor(state.energy))}%`;
    }

    function drawAirplane(x, y, radius, color, isPlayer = false) {
      ctx.save();
      ctx.translate(x, y);
      if (!isPlayer) ctx.rotate(Math.PI); // Enemy planes face down

      // Wings
      ctx.fillStyle = color;
      ctx.beginPath();
      ctx.moveTo(-radius, radius * 0.2);
      ctx.lineTo(radius, radius * 0.2);
      ctx.lineTo(0, -radius * 0.2);
      ctx.closePath();
      ctx.fill();

      // Fuselage
      ctx.fillStyle = isPlayer ? '#10b981' : '#f43f5e';
      ctx.beginPath();
      ctx.ellipse(0, 0, radius * 0.3, radius, 0, 0, Math.PI * 2);
      ctx.fill();

      // Cockpit
      ctx.fillStyle = '#38bdf8';
      ctx.beginPath();
      ctx.ellipse(0, -radius * 0.4, radius * 0.15, radius * 0.3, 0, 0, Math.PI * 2);
      ctx.fill();

      // Tail
      ctx.fillStyle = color;
      ctx.beginPath();
      ctx.moveTo(-radius * 0.4, radius * 0.8);
      ctx.lineTo(radius * 0.4, radius * 0.8);
      ctx.lineTo(0, radius * 0.5);
      ctx.closePath();
      ctx.fill();

      // Shield effect
      if (isPlayer && state.shieldTimer > 0) {
        ctx.strokeStyle = '#22d3ee';
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.arc(0, 0, radius * 1.4, 0, Math.PI * 2);
        ctx.stroke();
        ctx.fillStyle = 'rgba(34, 211, 238, 0.1)';
        ctx.fill();
      }

      ctx.restore();
    }

    function drawPowerUp(pu) {
      ctx.save();
      ctx.translate(pu.x, pu.y);
      ctx.beginPath();
      ctx.arc(0, 0, 15, 0, Math.PI * 2);
      ctx.fillStyle = pu.type === SKILLS.MULTI ? '#60a5fa' : pu.type === SKILLS.RAPID ? '#fbbf24' : '#22d3ee';
      ctx.fill();
      ctx.strokeStyle = 'white';
      ctx.lineWidth = 2;
      ctx.stroke();

      ctx.fillStyle = 'white';
      ctx.font = 'bold 14px Arial';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      const label = pu.type === SKILLS.MULTI ? 'M' : pu.type === SKILLS.RAPID ? 'R' : 'S';
      ctx.fillText(label, 0, 0);
      ctx.restore();
    }

    function shoot() {
      const now = performance.now();
      let cooldown = 250;
      if (state.rapidMode) cooldown = 100;
      if (state.rapidTimer > 0) cooldown = 80;

      if (now - state.lastShot < cooldown) return;
      state.lastShot = now;

      if (state.multiShotTimer > 0) {
        bullets.push({ x: player.x, y: player.y - 20, vx: 0, vy: -8, radius: 4 });
        bullets.push({ x: player.x, y: player.y - 20, vx: -2, vy: -7.5, radius: 4 });
        bullets.push({ x: player.x, y: player.y - 20, vx: 2, vy: -7.5, radius: 4 });
      } else {
        bullets.push({ x: player.x, y: player.y - 20, vx: 0, vy: -8, radius: 4 });
      }
    }

    function spawnEnemy() {
      const radius = 20 + Math.random() * 10;
      const x = radius + Math.random() * (canvas.width - radius * 2);
      const y = -radius - Math.random() * 100;
      const speed = 1.2 + Math.random() * 1.5 + state.score / 5000;
      enemies.push({ x, y, radius, speed, color: '#f87171' });
    }

    function createExplosion(x, y, color) {
      for (let i = 0; i < 15; i++) {
        particles.push({
          x,
          y,
          radius: 2 + Math.random() * 3,
          vx: (Math.random() - 0.5) * 5,
          vy: (Math.random() - 0.5) * 5,
          life: 40 + Math.random() * 20,
          color,
        });
      }
    }

    function update(delta) {
      if (!state.running || state.paused) return;

      const moveX = (keys['ArrowRight'] || keys['d'] ? 1 : 0) - (keys['ArrowLeft'] || keys['a'] ? 1 : 0);
      const moveY = (keys['ArrowDown'] || keys['s'] ? 1 : 0) - (keys['ArrowUp'] || keys['w'] ? 1 : 0);

      player.x += moveX * player.speed;
      player.y += moveY * player.speed;
      player.x = Math.max(player.radius, Math.min(canvas.width - player.radius, player.x));
      player.y = Math.max(player.radius, Math.min(canvas.height - player.radius, player.y));

      if (keys[' ']) shoot();

      state.spawnTimer += delta;
      if (state.spawnTimer > 800 - Math.min(400, state.score / 100)) {
        spawnEnemy();
        state.spawnTimer = 0;
      }

      // Update bullets
      for (let i = bullets.length - 1; i >= 0; i--) {
        const b = bullets[i];
        b.x += (b.vx || 0);
        b.y += (b.vy || -7);
        if (b.y < -20 || b.x < -20 || b.x > canvas.width + 20) bullets.splice(i, 1);
      }

      // Update powerups
      for (let i = powerUps.length - 1; i >= 0; i--) {
        const pu = powerUps[i];
        pu.y += 2;
        if (pu.y > canvas.height + 20) powerUps.splice(i, 1);
        
        const dist = Math.hypot(player.x - pu.x, player.y - pu.y);
        if (dist < player.radius + 15) {
          if (pu.type === SKILLS.MULTI) state.multiShotTimer = 8000;
          if (pu.type === SKILLS.RAPID) state.rapidTimer = 8000;
          if (pu.type === SKILLS.SHIELD) state.shieldTimer = 8000;
          powerUps.splice(i, 1);
          state.score += 100;
        }
      }

      // Update enemies
      for (let i = enemies.length - 1; i >= 0; i--) {
        const enemy = enemies[i];
        enemy.y += enemy.speed;
        
        if (enemy.y > canvas.height + enemy.radius) {
          enemies.splice(i, 1);
          state.combo = 1;
          continue;
        }

        // Collision with player
        const distToPlayer = Math.hypot(player.x - enemy.x, player.y - enemy.y);
        if (distToPlayer < player.radius + enemy.radius) {
          if (state.shieldTimer > 0) {
            state.shieldTimer = 0; // Consume shield
          } else {
            state.health -= 20;
          }
          enemies.splice(i, 1);
          state.combo = 1;
          createExplosion(player.x, player.y, '#ef4444');
          continue;
        }

        // Collision with bullets
        for (let j = bullets.length - 1; j >= 0; j--) {
          const b = bullets[j];
          const dist = Math.hypot(b.x - enemy.x, b.y - enemy.y);
          if (dist < b.radius + enemy.radius) {
            bullets.splice(j, 1);
            enemies.splice(i, 1);
            state.score += 50 * state.combo;
            state.combo = Math.min(10, state.combo + 1);
            state.energy = Math.min(100, state.energy + 5);
            createExplosion(enemy.x, enemy.y, enemy.color);
            
            // Drop powerup
            if (Math.random() < 0.15) {
              const types = [SKILLS.MULTI, SKILLS.RAPID, SKILLS.SHIELD];
              const type = types[Math.floor(Math.random() * types.length)];
              powerUps.push({ x: enemy.x, y: enemy.y, type });
            }
            break;
          }
        }
      }

      // Update particles
      for (let i = particles.length - 1; i >= 0; i--) {
        const p = particles[i];
        p.x += p.vx;
        p.y += p.vy;
        p.life -= 1;
        if (p.life <= 0) particles.splice(i, 1);
      }

      // Skill timers
      if (state.multiShotTimer > 0) state.multiShotTimer -= delta;
      if (state.rapidTimer > 0) state.rapidTimer -= delta;
      if (state.shieldTimer > 0) state.shieldTimer -= delta;

      if (state.energy >= 100 && keys['Shift']) {
        state.rapidMode = true;
        state.rapidModeTimer = 5000;
        state.energy = 0;
      }

      if (state.rapidMode) {
        state.rapidModeTimer -= delta;
        if (state.rapidModeTimer <= 0) state.rapidMode = false;
      }

      if (state.health <= 0) {
        state.running = false;
        state.paused = true;
        overlay.classList.remove('opacity-0');
        overlay.classList.add('opacity-100');
      }

      updateHUD();
    }

    function render() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Background stars
      ctx.fillStyle = 'rgba(15, 23, 42, 0.4)';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      for (let i = 0; i < 50; i++) {
        ctx.fillStyle = `rgba(255,255,255,${Math.random() * 0.2})`;
        ctx.fillRect(Math.random() * canvas.width, Math.random() * canvas.height, 2, 2);
      }

      // Draw Power-ups
      powerUps.forEach(drawPowerUp);

      // Draw Player
      drawAirplane(player.x, player.y, player.radius, '#34d399', true);

      // Draw Bullets
      bullets.forEach(bullet => {
        ctx.fillStyle = '#38bdf8';
        ctx.shadowBlur = 10;
        ctx.shadowColor = '#38bdf8';
        ctx.beginPath();
        ctx.arc(bullet.x, bullet.y, bullet.radius, 0, Math.PI * 2);
        ctx.fill();
        ctx.shadowBlur = 0;
      });

      // Draw Enemies
      enemies.forEach(enemy => {
        drawAirplane(enemy.x, enemy.y, enemy.radius, enemy.color, false);
      });

      // Draw Particles
      particles.forEach(p => {
        ctx.fillStyle = p.color;
        ctx.globalAlpha = p.life / 40;
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
        ctx.fill();
        ctx.globalAlpha = 1;
      });

      // Rapid Mode UI indicator
      if (state.rapidMode || state.rapidTimer > 0) {
        ctx.strokeStyle = 'rgba(250,204,21,0.5)';
        ctx.lineWidth = 4;
        ctx.setLineDash([10, 5]);
        ctx.strokeRect(5, 5, canvas.width - 10, canvas.height - 10);
        ctx.setLineDash([]);
      }
    }

    let lastTime = performance.now();
    function gameLoop(timestamp) {
      const delta = timestamp - lastTime;
      lastTime = timestamp;
      update(delta);
      render();
      requestAnimationFrame(gameLoop);
    }

    window.addEventListener('keydown', event => {
      keys[event.key] = true;
      if (event.key === ' ') event.preventDefault();
    });

    window.addEventListener('keyup', event => {
      keys[event.key] = false;
    });

    startBtn.addEventListener('click', () => {
      if (!state.running) {
        resetGame();
        state.running = true;
      }
      state.paused = false;
      overlay.classList.add('opacity-0');
      overlay.classList.remove('opacity-100');
    });

    pauseBtn.addEventListener('click', () => {
      state.paused = true;
      overlay.classList.remove('opacity-0');
      overlay.classList.add('opacity-100');
    });

    overlay.addEventListener('click', () => {
      state.paused = false;
      overlay.classList.add('opacity-0');
      overlay.classList.remove('opacity-100');
    });

    requestAnimationFrame(gameLoop);
  </script>
</body>
</html>
